---
title: "ABI Argentina Mobility Report"
author: 'NAZ:  C. Ieva'
output: word_document 
always_allow_html: true

---

```{r setup, include=FALSE}
###Load Libraries
library(flextable)
library(socviz)
library(tinytex)
library(visNetwork)
library(networkD3)
library(vctrs)
library(ggwordcloud)
library(tidyverse)
library(fastDummies)
library(gbm)
library(rpart.plot)
library(rpart)
library(caret)
library(plotly)
library(rbokeh)
library(crosstalk)
library(MonteCarlo)
library(SCperf)
library(DT)
library(dplyr)
library(qrmtools)
library(TTR)
library(xts)
library(zoo)
library(dplyr)
library(quantmod)
library(qrmtools)
library(forecastHybrid)
library(forecast)
library(Quandl)
library(ggplot2)
library(ggridges)
library(MASS)
library(GMDH)
library(nnfor)
library(glmnet)
library(stats)
library(keras)
library(xgboost)
library(XBRL)
library(finreportr)
library(reshape2)
library(highcharter)
library(dygraphs)
library(PerformanceAnalytics)
library(dplyr)
library(purrr)
library(tidyr)
library(wordcloud)
library(igraph)
library(statnet)
library(dplyr)
library(network)
library(magrittr)
library(googledrive)
library(googlesheets)
library(reshape2)
library(ggplot2)
library(GGally)
library(sna)
library(DT)
library(reshape2)
library(statnet)
library(network)   #Use for visualizations
library(ggridges)
library(ggplot2)
library(intergraph)
library(gtrendsR)
library(prophet)
library(choroplethr)
library(statebins)
library(quanteda)
library(readtext)
library(tm)
library(quanteda.textmodels)
library(ggdendro)
library(maps)
library(usmap)
library(stringr)
library(sf)
library(viridis)
library(maps)
library(socviz)
library(tigris)
library(tidycensus)
library(tidyverse)
library(leaflet)
library(lubridate)
library(blsAPI)
library(blscrapeR)
library(tibble)
options(scipen=999)



```





```{r Data Intake, echo=FALSE, include=FALSE}

mbr<-read_csv("C:/Users/y726269/Documents/R_Working_Folder/Mobility_Report/Mobility_Report.csv")  #Local Folder

### Clean Data
#mbr$date <- dmy(mbr$date) #Convert to Date  
mbr$sub_region_1[is.na(mbr$sub_region_1)] <-0  # Remove NAs
mbr$sub_region_2[is.na(mbr$sub_region_2)] <-0  # Remove NAs
mbr<-data.frame(mbr)

#glimpse(mbr)
### Build By Country
AR_DF <- mbr %>% 
  dplyr::filter(mbr$country_region_code =="AR" & mbr$sub_region_1 =="0") %>%
  dplyr::select(date, retail_and_recreation_percent_change_from_baseline, parks_percent_change_from_baseline, transit_stations_percent_change_from_baseline,
         workplaces_percent_change_from_baseline, residential_percent_change_from_baseline, grocery_and_pharmacy_percent_change_from_baseline)

AR_xts<-xts(x=AR_DF[,-1], order.by=AR_DF$date)

AR_RR_GG <- ggplot(AR_DF, aes(x=date, y=retail_and_recreation_percent_change_from_baseline)) +
   geom_point() +
   geom_smooth(method = "glm", se = TRUE, method.args = list(family = "gaussian"), linetype = "dashed") + ggtitle("AR: Retail and Recr  Mobility Index Percent Change") 

AR_GR_GG <- ggplot(AR_DF, aes(x=date, y=grocery_and_pharmacy_percent_change_from_baseline)) +
   geom_point() +
   geom_smooth(method = "glm", se = TRUE, method.args = list(family = "gaussian"), linetype = "dashed") + ggtitle("AR: Grocery Mobility Index Percent Change") 

AR_PK_GG <- ggplot(AR_DF, aes(x=date, y=parks_percent_change_from_baseline)) +
   geom_point() +
   geom_smooth(method = "glm", se = TRUE, method.args = list(family = "gaussian"), linetype = "dashed") + ggtitle("AR: Parks Mobility Index Percent Change") 


AR_TR_GG <- ggplot(AR_DF, aes(x=date, y=transit_stations_percent_change_from_baseline)) +
   geom_point() +
   geom_smooth(method = "glm", se = TRUE, method.args = list(family = "gaussian"), linetype = "dashed") + ggtitle("AR: Transit Mobility Index Percent Change") 


AR_WK_GG <- ggplot(AR_DF, aes(x=date, y=workplaces_percent_change_from_baseline)) +
   geom_point() +
   geom_smooth(method = "glm", se = TRUE, method.args = list(family = "gaussian"), linetype = "dashed") + ggtitle("AR: Workplace Mobility Index Percent Change") 


AR_RS_GG <- ggplot(AR_DF, aes(x=date, y=residential_percent_change_from_baseline)) +
   geom_point() +
   geom_smooth(method = "glm", se = TRUE, method.args = list(family = "gaussian"), linetype = "dashed") + ggtitle("AR: Residential Mobility Index Percent Change") 






```

# Historical AR Country Data

Historical country wide data for AR

## Retail
```{r Retail GG, out.width='100%', message=FALSE, echo=FALSE}
AR_RR_GG
```

## Grocery
```{r Grocery GG, out.width='100%', message=FALSE, echo=FALSE}
AR_GR_GG
```

## Parks
```{r Parks GG, out.width='100%', message=FALSE, echo=FALSE}
AR_PK_GG
```

## Transit
```{r Transit GG, out.width='100%', message=FALSE, echo=FALSE}
AR_TR_GG
```

## Workplace
```{r Workplace, out.width='100%', message=FALSE, echo=FALSE}
AR_WK_GG
```

## Residential
```{r Residential, out.width='100%', message=FALSE, echo=FALSE}
AR_RS_GG
```

# Prediction Country Wide AR

## Retail and Recreation Prediction
```{r Retail Pred, out.width='100%', message=FALSE, echo=FALSE, warnings=FALSE}
L<-14  #Days Pred

b2_pred<-data.frame(AR_DF$date,AR_DF$retail_and_recreation_percent_change_from_baseline)
colnames(b2_pred)<-c('ds','y')

model2 <- prophet(b2_pred, daily.seasonality= TRUE, weekly.seasonality=TRUE) # Fit Model


### Make Future DF
future2 <- make_future_dataframe(model2, periods = L, freq = "days", include_history = FALSE) 
#FREQ = Hourly

### Model Forecast
forecast2 <- predict(model2, future2)  #Forecast
retail_pred<-forecast2$yhat
plot(model2, forecast2)

```

## Parks Prediction
```{r Parks Pred, out.width='100%', echo=FALSE, message=FALSE, warnings=FALSE}

b2_pred<-data.frame(AR_DF$date,AR_DF$parks_percent_change_from_baseline)
colnames(b2_pred)<-c('ds','y')

model2 <- prophet(b2_pred, daily.seasonality= TRUE, weekly.seasonality=TRUE) # Fit Model


### Make Future DF
future2 <- make_future_dataframe(model2, periods = L, freq = "days", include_history = FALSE) 
#FREQ = Hourly

### Model Forecast
forecast2 <- predict(model2, future2)  #Forecast
parks_pred<-forecast2$yhat
plot(model2, forecast2)
```

## Grocery & Pharmacy Prediction
```{r Grocery Pred, out.width='100%', echo=FALSE,message=FALSE,  warnings=FALSE}

b2_pred<-data.frame(AR_DF$date,AR_DF$grocery_and_pharmacy_percent_change_from_baseline)
colnames(b2_pred)<-c('ds','y')

model2 <- prophet(b2_pred, daily.seasonality= TRUE, weekly.seasonality=TRUE) # Fit Model


### Make Future DF
future2 <- make_future_dataframe(model2, periods = L, freq = "days", include_history = FALSE) 
#FREQ = Hourly

### Model Forecast
forecast2 <- predict(model2, future2)  #Forecast
grocery_pred<-forecast2$yhat
plot(model2, forecast2)
```

## Transit Prediction
```{r Transit Pred, out.width='100%', echo=FALSE, message=FALSE, warnings=FALSE}

b2_pred<-data.frame(AR_DF$date,AR_DF$transit_stations_percent_change_from_baseline)
colnames(b2_pred)<-c('ds','y')

model2 <- prophet(b2_pred, daily.seasonality= TRUE, weekly.seasonality=TRUE) # Fit Model


### Make Future DF
future2 <- make_future_dataframe(model2, periods = L, freq = "days", include_history = FALSE) 
#FREQ = Hourly

### Model Forecast
forecast2 <- predict(model2, future2)  #Forecast
transit_pred<-forecast2$yhat
plot(model2, forecast2)
```

## Workplace Prediction
```{r WK PLace, out.width='100%', echo=FALSE, message=FALSE, warnings=FALSE}

b2_pred<-data.frame(AR_DF$date,AR_DF$workplaces_percent_change_from_baseline)
colnames(b2_pred)<-c('ds','y')

model2 <- prophet(b2_pred, daily.seasonality= TRUE, weekly.seasonality=TRUE) # Fit Model


### Make Future DF
future2 <- make_future_dataframe(model2, periods = L, freq = "days", include_history = FALSE) 
#FREQ = Hourly

### Model Forecast
forecast2 <- predict(model2, future2)  #Forecast
workplace_pred<-forecast2$yhat
plot(model2, forecast2)
```


## Residential Percent Change
```{r Zip Code, out.width='100%', echo=FALSE, message=FALSE, warnings=FALSE}

b2_pred<-data.frame(AR_DF$date,AR_DF$residential_percent_change_from_baseline)
colnames(b2_pred)<-c('ds','y')

model2 <- prophet(b2_pred, daily.seasonality= TRUE, weekly.seasonality=TRUE) # Fit Model


### Make Future DF
future2 <- make_future_dataframe(model2, periods = L, freq = "days", include_history = FALSE) 
#FREQ = Hourly

### Model Forecast
forecast2 <- predict(model2, future2)  #Forecast
res_pred<-forecast2$yhat
plot(model2, forecast2)


### Make CSV
pred_df<-data.frame(future2,res_pred,workplace_pred, grocery_pred, transit_pred,parks_pred, retail_pred)
write.csv(pred_df, "AR_PRED.csv",row.names = FALSE)
```


```{r Make Leaflet, echo=FALSE, message=FALSE, include=FALSE}

### Select Options 
options(nextjournal.display.htmlwidgetsEnabled=TRUE)
options(tigris_use_cache = TRUE)


### Build By Country
AR_State_DF <- mbr %>% 
  dplyr::filter(mbr$country_region_code =="AR" & mbr$sub_region_1 !="0") %>%
  dplyr::select(sub_region_1, retail_and_recreation_percent_change_from_baseline, parks_percent_change_from_baseline, transit_stations_percent_change_from_baseline,
         workplaces_percent_change_from_baseline, residential_percent_change_from_baseline, grocery_and_pharmacy_percent_change_from_baseline)

AR_State_DF<-data.frame(AR_State_DF)
AR_State_DF[is.na(AR_State_DF)] <-0
#glimpse(AR_State_AVG)

### Summarize  Mean

AR_State_AVG<-AR_State_DF %>% dplyr::group_by(sub_region_1) %>% summarise(avg_retail = mean(retail_and_recreation_percent_change_from_baseline),
  avg_grocery = mean(grocery_and_pharmacy_percent_change_from_baseline),
  avg_parks = mean(parks_percent_change_from_baseline),
  avg_transit=mean(transit_stations_percent_change_from_baseline),
  avg_workplace=mean(workplaces_percent_change_from_baseline),  
  avg_residential=mean(residential_percent_change_from_baseline))

round(AR_State_AVG[,-1], digits=2)
### Cluster Analysis
AR_State_AVG_Values<-AR_State_AVG[,-1]

KS<-kmeans(x =AR_State_AVG_Values, centers = 4)  #Use x-xis to assign cluster per user)
#glimpse(K4)

### Append Cluster to Data
AR_State_AVG$cluster <- as.integer(KS$cluster)  #Append Cluster to Training


State_Cluster_CF<-ggplot(data = AR_State_AVG, mapping = aes(x =avg_residential, y = avg_workplace, colour=cluster, label = sub_region_1)) +
    geom_point(alpha = .1) +
    geom_jitter(alpha = 0.3)  


round(AR_State_AVG[,-1], digits=2)

AR_State_AVG<-data.frame(AR_State_AVG)

### States Average
AR_State_AVG_DT <-datatable(AR_State_AVG, extensions = 'Buttons', options = list(
    dom = 'Bfrtip',
    buttons = c('copy', 'csv', 'excel', 'pdf', 'print')
  )
  )
### Make CSV
write.csv(AR_State_AVG, "AR_State_AVG.csv",row.names = FALSE)

glimpse(AR_State_AVG)

region_names<-unique(AR_State_AVG$sub_region_1 )
```

# Region Data

## Region Data
```{r  Table, fig.align='center', fig.cap='State Data', echo=FALSE, message=FALSE, fig.height=10, fig.width=7}
    ft <- flextable(AR_State_AVG)
    ft

```

## Cluster Plot By Regions
```{r Cluster1, out.width='100%', message=FALSE, echo=FALSE}
ggplotly(State_Cluster_CF)
```

## Historical Graph
```{r Chart 1, out.width='100%', message=FALSE, echo=FALSE}

name<-region_names[1]

AR_DF <- mbr %>% 
  dplyr::filter(mbr$country_region_code =="AR" & mbr$sub_region_1 ==(paste(name))) %>%
  dplyr::select(date, retail_and_recreation_percent_change_from_baseline, parks_percent_change_from_baseline, transit_stations_percent_change_from_baseline,
         workplaces_percent_change_from_baseline, residential_percent_change_from_baseline, grocery_and_pharmacy_percent_change_from_baseline)

meltdf <- melt(AR_DF,id="date")
ggplot(meltdf,aes(x=date,y=value,colour=variable,group=variable)) + geom_line() +  labs(subtitle=paste(name), 
       title= "Mobility Indexes") +theme(legend.position="bottom", legend.key.size=unit(2,"point")) +guides(colour=guide_legend(nrow=6))


```

```{r Chart 2, out.width='100%', message=FALSE, echo=FALSE}

name<-region_names[2]

AR_DF <- mbr %>% 
  dplyr::filter(mbr$country_region_code =="AR" & mbr$sub_region_1 ==(paste(name))) %>%
  dplyr::select(date, retail_and_recreation_percent_change_from_baseline, parks_percent_change_from_baseline, transit_stations_percent_change_from_baseline,
         workplaces_percent_change_from_baseline, residential_percent_change_from_baseline, grocery_and_pharmacy_percent_change_from_baseline)

meltdf <- melt(AR_DF,id="date")
ggplot(meltdf,aes(x=date,y=value,colour=variable,group=variable)) + geom_line() +  labs(subtitle=paste(name), 
       title= "Mobility Indexes") +theme(legend.position="bottom", legend.key.size=unit(2,"point")) +guides(colour=guide_legend(nrow=6))


```

```{r Chart 3, out.width='100%', message=FALSE, echo=FALSE}

name<-region_names[3]

AR_DF <- mbr %>% 
  dplyr::filter(mbr$country_region_code =="AR" & mbr$sub_region_1 ==(paste(name))) %>%
  dplyr::select(date, retail_and_recreation_percent_change_from_baseline, parks_percent_change_from_baseline, transit_stations_percent_change_from_baseline,
         workplaces_percent_change_from_baseline, residential_percent_change_from_baseline, grocery_and_pharmacy_percent_change_from_baseline)

meltdf <- melt(AR_DF,id="date")
ggplot(meltdf,aes(x=date,y=value,colour=variable,group=variable)) + geom_line() +  labs(subtitle=paste(name), 
       title= "Mobility Indexes") +theme(legend.position="bottom", legend.key.size=unit(2,"point")) +guides(colour=guide_legend(nrow=6))


```

```{r Chart 4, out.width='100%', message=FALSE, echo=FALSE}

name<-region_names[4]

AR_DF <- mbr %>% 
  dplyr::filter(mbr$country_region_code =="AR" & mbr$sub_region_1 ==(paste(name))) %>%
  dplyr::select(date, retail_and_recreation_percent_change_from_baseline, parks_percent_change_from_baseline, transit_stations_percent_change_from_baseline,
         workplaces_percent_change_from_baseline, residential_percent_change_from_baseline, grocery_and_pharmacy_percent_change_from_baseline)

meltdf <- melt(AR_DF,id="date")
ggplot(meltdf,aes(x=date,y=value,colour=variable,group=variable)) + geom_line() +  labs(subtitle=paste(name), 
       title= "Mobility Indexes") +theme(legend.position="bottom", legend.key.size=unit(2,"point")) +guides(colour=guide_legend(nrow=6))


```

```{r Chart 5, out.width='100%', message=FALSE, echo=FALSE}

name<-region_names[5]

AR_DF <- mbr %>% 
  dplyr::filter(mbr$country_region_code =="AR" & mbr$sub_region_1 ==(paste(name))) %>%
  dplyr::select(date, retail_and_recreation_percent_change_from_baseline, parks_percent_change_from_baseline, transit_stations_percent_change_from_baseline,
         workplaces_percent_change_from_baseline, residential_percent_change_from_baseline, grocery_and_pharmacy_percent_change_from_baseline)

meltdf <- melt(AR_DF,id="date")
ggplot(meltdf,aes(x=date,y=value,colour=variable,group=variable)) + geom_line() +  labs(subtitle=paste(name), 
       title= "Mobility Indexes") +theme(legend.position="bottom", legend.key.size=unit(2,"point")) +guides(colour=guide_legend(nrow=6))


```

```{r Chart 6, out.width='100%', message=FALSE, echo=FALSE}

name<-region_names[6]

AR_DF <- mbr %>% 
  dplyr::filter(mbr$country_region_code =="AR" & mbr$sub_region_1 ==(paste(name))) %>%
  dplyr::select(date, retail_and_recreation_percent_change_from_baseline, parks_percent_change_from_baseline, transit_stations_percent_change_from_baseline,
         workplaces_percent_change_from_baseline, residential_percent_change_from_baseline, grocery_and_pharmacy_percent_change_from_baseline)

meltdf <- melt(AR_DF,id="date")
ggplot(meltdf,aes(x=date,y=value,colour=variable,group=variable)) + geom_line() +  labs(subtitle=paste(name), 
       title= "Mobility Indexes") +theme(legend.position="bottom", legend.key.size=unit(2,"point")) +guides(colour=guide_legend(nrow=6))


```

```{r Chart 7, out.width='100%', message=FALSE, echo=FALSE}

name<-region_names[7]

AR_DF <- mbr %>% 
  dplyr::filter(mbr$country_region_code =="AR" & mbr$sub_region_1 ==(paste(name))) %>%
  dplyr::select(date, retail_and_recreation_percent_change_from_baseline, parks_percent_change_from_baseline, transit_stations_percent_change_from_baseline,
         workplaces_percent_change_from_baseline, residential_percent_change_from_baseline, grocery_and_pharmacy_percent_change_from_baseline)

meltdf <- melt(AR_DF,id="date")
ggplot(meltdf,aes(x=date,y=value,colour=variable,group=variable)) + geom_line() +  labs(subtitle=paste(name), 
       title= "Mobility Indexes") +theme(legend.position="bottom", legend.key.size=unit(2,"point")) +guides(colour=guide_legend(nrow=6))


```

```{r Chart 8, out.width='100%', message=FALSE, echo=FALSE}

name<-region_names[8]

AR_DF <- mbr %>% 
  dplyr::filter(mbr$country_region_code =="AR" & mbr$sub_region_1 ==(paste(name))) %>%
  dplyr::select(date, retail_and_recreation_percent_change_from_baseline, parks_percent_change_from_baseline, transit_stations_percent_change_from_baseline,
         workplaces_percent_change_from_baseline, residential_percent_change_from_baseline, grocery_and_pharmacy_percent_change_from_baseline)

meltdf <- melt(AR_DF,id="date")
ggplot(meltdf,aes(x=date,y=value,colour=variable,group=variable)) + geom_line() +  labs(subtitle=paste(name), 
       title= "Mobility Indexes") +theme(legend.position="bottom", legend.key.size=unit(2,"point")) +guides(colour=guide_legend(nrow=6))


```

```{r Chart 9, out.width='100%', message=FALSE, echo=FALSE}

name<-region_names[9]

AR_DF <- mbr %>% 
  dplyr::filter(mbr$country_region_code =="AR" & mbr$sub_region_1 ==(paste(name))) %>%
  dplyr::select(date, retail_and_recreation_percent_change_from_baseline, parks_percent_change_from_baseline, transit_stations_percent_change_from_baseline,
         workplaces_percent_change_from_baseline, residential_percent_change_from_baseline, grocery_and_pharmacy_percent_change_from_baseline)

meltdf <- melt(AR_DF,id="date")
ggplot(meltdf,aes(x=date,y=value,colour=variable,group=variable)) + geom_line() +  labs(subtitle=paste(name), 
       title= "Mobility Indexes") +theme(legend.position="bottom", legend.key.size=unit(2,"point")) +guides(colour=guide_legend(nrow=6))


```

```{r Chart 10, out.width='100%', message=FALSE, echo=FALSE}

name<-region_names[10]

AR_DF <- mbr %>% 
  dplyr::filter(mbr$country_region_code =="AR" & mbr$sub_region_1 ==(paste(name))) %>%
  dplyr::select(date, retail_and_recreation_percent_change_from_baseline, parks_percent_change_from_baseline, transit_stations_percent_change_from_baseline,
         workplaces_percent_change_from_baseline, residential_percent_change_from_baseline, grocery_and_pharmacy_percent_change_from_baseline)

meltdf <- melt(AR_DF,id="date")
ggplot(meltdf,aes(x=date,y=value,colour=variable,group=variable)) + geom_line() +  labs(subtitle=paste(name), 
       title= "Mobility Indexes") +theme(legend.position="bottom", legend.key.size=unit(2,"point")) +guides(colour=guide_legend(nrow=6))


```

```{r Chart 11, out.width='100%', message=FALSE, echo=FALSE}

name<-region_names[11]

AR_DF <- mbr %>% 
  dplyr::filter(mbr$country_region_code =="AR" & mbr$sub_region_1 ==(paste(name))) %>%
  dplyr::select(date, retail_and_recreation_percent_change_from_baseline, parks_percent_change_from_baseline, transit_stations_percent_change_from_baseline,
         workplaces_percent_change_from_baseline, residential_percent_change_from_baseline, grocery_and_pharmacy_percent_change_from_baseline)

meltdf <- melt(AR_DF,id="date")
ggplot(meltdf,aes(x=date,y=value,colour=variable,group=variable)) + geom_line() +  labs(subtitle=paste(name), 
       title= "Mobility Indexes") +theme(legend.position="bottom", legend.key.size=unit(2,"point")) +guides(colour=guide_legend(nrow=6))


```

```{r Chart 12, out.width='100%', message=FALSE, echo=FALSE}

name<-region_names[12]

AR_DF <- mbr %>% 
  dplyr::filter(mbr$country_region_code =="AR" & mbr$sub_region_1 ==(paste(name))) %>%
  dplyr::select(date, retail_and_recreation_percent_change_from_baseline, parks_percent_change_from_baseline, transit_stations_percent_change_from_baseline,
         workplaces_percent_change_from_baseline, residential_percent_change_from_baseline, grocery_and_pharmacy_percent_change_from_baseline)

meltdf <- melt(AR_DF,id="date")
ggplot(meltdf,aes(x=date,y=value,colour=variable,group=variable)) + geom_line() +  labs(subtitle=paste(name), 
       title= "Mobility Indexes") +theme(legend.position="bottom", legend.key.size=unit(2,"point")) +guides(colour=guide_legend(nrow=6))


```

```{r Chart 13, out.width='100%', message=FALSE, echo=FALSE}

name<-region_names[13]

AR_DF <- mbr %>% 
  dplyr::filter(mbr$country_region_code =="AR" & mbr$sub_region_1 ==(paste(name))) %>%
  dplyr::select(date, retail_and_recreation_percent_change_from_baseline, parks_percent_change_from_baseline, transit_stations_percent_change_from_baseline,
         workplaces_percent_change_from_baseline, residential_percent_change_from_baseline, grocery_and_pharmacy_percent_change_from_baseline)

meltdf <- melt(AR_DF,id="date")
ggplot(meltdf,aes(x=date,y=value,colour=variable,group=variable)) + geom_line() +  labs(subtitle=paste(name), 
       title= "Mobility Indexes") +theme(legend.position="bottom", legend.key.size=unit(2,"point")) +guides(colour=guide_legend(nrow=6))


```

```{r Chart 14, out.width='100%', message=FALSE, echo=FALSE}

name<-region_names[14]

AR_DF <- mbr %>% 
  dplyr::filter(mbr$country_region_code =="AR" & mbr$sub_region_1 ==(paste(name))) %>%
  dplyr::select(date, retail_and_recreation_percent_change_from_baseline, parks_percent_change_from_baseline, transit_stations_percent_change_from_baseline,
         workplaces_percent_change_from_baseline, residential_percent_change_from_baseline, grocery_and_pharmacy_percent_change_from_baseline)

meltdf <- melt(AR_DF,id="date")
ggplot(meltdf,aes(x=date,y=value,colour=variable,group=variable)) + geom_line() +  labs(subtitle=paste(name), 
       title= "Mobility Indexes") +theme(legend.position="bottom", legend.key.size=unit(2,"point")) +guides(colour=guide_legend(nrow=6))


```

```{r Chart 15, out.width='100%', message=FALSE, echo=FALSE}

name<-region_names[15]

AR_DF <- mbr %>% 
  dplyr::filter(mbr$country_region_code =="AR" & mbr$sub_region_1 ==(paste(name))) %>%
  dplyr::select(date, retail_and_recreation_percent_change_from_baseline, parks_percent_change_from_baseline, transit_stations_percent_change_from_baseline,
         workplaces_percent_change_from_baseline, residential_percent_change_from_baseline, grocery_and_pharmacy_percent_change_from_baseline)

meltdf <- melt(AR_DF,id="date")
ggplot(meltdf,aes(x=date,y=value,colour=variable,group=variable)) + geom_line() +  labs(subtitle=paste(name), 
       title= "Mobility Indexes") +theme(legend.position="bottom", legend.key.size=unit(2,"point")) +guides(colour=guide_legend(nrow=6))


```

```{r Chart 16, out.width='100%', message=FALSE, echo=FALSE}

name<-region_names[16]

AR_DF <- mbr %>% 
  dplyr::filter(mbr$country_region_code =="AR" & mbr$sub_region_1 ==(paste(name))) %>%
  dplyr::select(date, retail_and_recreation_percent_change_from_baseline, parks_percent_change_from_baseline, transit_stations_percent_change_from_baseline,
         workplaces_percent_change_from_baseline, residential_percent_change_from_baseline, grocery_and_pharmacy_percent_change_from_baseline)

meltdf <- melt(AR_DF,id="date")
ggplot(meltdf,aes(x=date,y=value,colour=variable,group=variable)) + geom_line() +  labs(subtitle=paste(name), 
       title= "Mobility Indexes") +theme(legend.position="bottom", legend.key.size=unit(2,"point")) +guides(colour=guide_legend(nrow=6))


```

```{r Chart 17, out.width='100%', message=FALSE, echo=FALSE}

name<-region_names[17]

AR_DF <- mbr %>% 
  dplyr::filter(mbr$country_region_code =="AR" & mbr$sub_region_1 ==(paste(name))) %>%
  dplyr::select(date, retail_and_recreation_percent_change_from_baseline, parks_percent_change_from_baseline, transit_stations_percent_change_from_baseline,
         workplaces_percent_change_from_baseline, residential_percent_change_from_baseline, grocery_and_pharmacy_percent_change_from_baseline)

meltdf <- melt(AR_DF,id="date")
ggplot(meltdf,aes(x=date,y=value,colour=variable,group=variable)) + geom_line() +  labs(subtitle=paste(name), 
       title= "Mobility Indexes") +theme(legend.position="bottom", legend.key.size=unit(2,"point")) +guides(colour=guide_legend(nrow=6))


```

```{r Chart 18, out.width='100%', message=FALSE, echo=FALSE}

name<-region_names[18]

AR_DF <- mbr %>% 
  dplyr::filter(mbr$country_region_code =="AR" & mbr$sub_region_1 ==(paste(name))) %>%
  dplyr::select(date, retail_and_recreation_percent_change_from_baseline, parks_percent_change_from_baseline, transit_stations_percent_change_from_baseline,
         workplaces_percent_change_from_baseline, residential_percent_change_from_baseline, grocery_and_pharmacy_percent_change_from_baseline)

meltdf <- melt(AR_DF,id="date")
ggplot(meltdf,aes(x=date,y=value,colour=variable,group=variable)) + geom_line() +  labs(subtitle=paste(name), 
       title= "Mobility Indexes") +theme(legend.position="bottom", legend.key.size=unit(2,"point")) +guides(colour=guide_legend(nrow=6))


```

```{r Chart 19, out.width='100%', message=FALSE, echo=FALSE}

name<-region_names[19]

AR_DF <- mbr %>% 
  dplyr::filter(mbr$country_region_code =="AR" & mbr$sub_region_1 ==(paste(name))) %>%
  dplyr::select(date, retail_and_recreation_percent_change_from_baseline, parks_percent_change_from_baseline, transit_stations_percent_change_from_baseline,
         workplaces_percent_change_from_baseline, residential_percent_change_from_baseline, grocery_and_pharmacy_percent_change_from_baseline)

meltdf <- melt(AR_DF,id="date")
ggplot(meltdf,aes(x=date,y=value,colour=variable,group=variable)) + geom_line() +  labs(subtitle=paste(name), 
       title= "Mobility Indexes")  +theme(legend.position="bottom", legend.key.size=unit(2,"point")) +guides(colour=guide_legend(nrow=6))


```

```{r Chart 20, out.width='100%', message=FALSE, echo=FALSE}

name<-region_names[20]

AR_DF <- mbr %>% 
  dplyr::filter(mbr$country_region_code =="AR" & mbr$sub_region_1 ==(paste(name))) %>%
  dplyr::select(date, retail_and_recreation_percent_change_from_baseline, parks_percent_change_from_baseline, transit_stations_percent_change_from_baseline,
         workplaces_percent_change_from_baseline, residential_percent_change_from_baseline, grocery_and_pharmacy_percent_change_from_baseline)

meltdf <- melt(AR_DF,id="date")
ggplot(meltdf,aes(x=date,y=value,colour=variable,group=variable)) + geom_line() +  labs(subtitle=paste(name), 
       title= "Mobility Indexes") +theme(legend.position="bottom", legend.key.size=unit(2,"point")) +guides(colour=guide_legend(nrow=6))


```

```{r Chart 21A, out.width='100%', message=FALSE, echo=FALSE}

name<-region_names[21]

AR_DF <- mbr %>% 
  dplyr::filter(mbr$country_region_code =="AR" & mbr$sub_region_1 ==(paste(name))) %>%
  dplyr::select(date, retail_and_recreation_percent_change_from_baseline, parks_percent_change_from_baseline, transit_stations_percent_change_from_baseline,
         workplaces_percent_change_from_baseline, residential_percent_change_from_baseline, grocery_and_pharmacy_percent_change_from_baseline)

meltdf <- melt(AR_DF,id="date")
ggplot(meltdf,aes(x=date,y=value,colour=variable,group=variable)) + geom_line() +  labs(subtitle=paste(name), 
       title= "Mobility Indexes") +theme(legend.position="bottom", legend.key.size=unit(2,"point")) +guides(colour=guide_legend(nrow=6))


```

```{r Chart 22, out.width='100%', message=FALSE, echo=FALSE}

name<-region_names[22]

AR_DF <- mbr %>% 
  dplyr::filter(mbr$country_region_code =="AR" & mbr$sub_region_1 ==(paste(name))) %>%
  dplyr::select(date, retail_and_recreation_percent_change_from_baseline, parks_percent_change_from_baseline, transit_stations_percent_change_from_baseline,
         workplaces_percent_change_from_baseline, residential_percent_change_from_baseline, grocery_and_pharmacy_percent_change_from_baseline)

meltdf <- melt(AR_DF,id="date")
ggplot(meltdf,aes(x=date,y=value,colour=variable,group=variable)) + geom_line() +  labs(subtitle=paste(name), 
       title= "Mobility Indexes") +theme(legend.position="bottom", legend.key.size=unit(2,"point")) +guides(colour=guide_legend(nrow=6))


```

```{r Chart 23, out.width='100%', message=FALSE, echo=FALSE}

name<-region_names[23]

AR_DF <- mbr %>% 
  dplyr::filter(mbr$country_region_code =="AR" & mbr$sub_region_1 ==(paste(name))) %>%
  dplyr::select(date, retail_and_recreation_percent_change_from_baseline, parks_percent_change_from_baseline, transit_stations_percent_change_from_baseline,
         workplaces_percent_change_from_baseline, residential_percent_change_from_baseline, grocery_and_pharmacy_percent_change_from_baseline)

meltdf <- melt(AR_DF,id="date")
ggplot(meltdf,aes(x=date,y=value,colour=variable,group=variable)) + geom_line() +  labs(subtitle=paste(name), 
       title= "Mobility Indexes") +theme(legend.position="bottom", legend.key.size=unit(2,"point")) +guides(colour=guide_legend(nrow=6))


```

```{r Chart 24, out.width='100%', message=FALSE, echo=FALSE}

name<-region_names[24]

AR_DF <- mbr %>% 
  dplyr::filter(mbr$country_region_code =="AR" & mbr$sub_region_1 ==(paste(name))) %>%
  dplyr::select(date, retail_and_recreation_percent_change_from_baseline, parks_percent_change_from_baseline, transit_stations_percent_change_from_baseline,
         workplaces_percent_change_from_baseline, residential_percent_change_from_baseline, grocery_and_pharmacy_percent_change_from_baseline)

meltdf <- melt(AR_DF,id="date")
ggplot(meltdf,aes(x=date,y=value,colour=variable,group=variable)) + geom_line() +  labs(subtitle=paste(name), 
       title= "Mobility Indexes") +theme(legend.position="bottom", legend.key.size=unit(2,"point")) +guides(colour=guide_legend(nrow=6))


```

# BA Predictions
```{r BA PRED, out.width='100%', echo=FALSE, message=FALSE, warnings=FALSE}

name<-region_names[1]


BA_DF <- mbr %>% 
  dplyr::filter(mbr$country_region_code =="AR" & mbr$sub_region_1 ==(paste(name))) %>%
  dplyr::select(date, retail_and_recreation_percent_change_from_baseline, parks_percent_change_from_baseline, transit_stations_percent_change_from_baseline,
         workplaces_percent_change_from_baseline, residential_percent_change_from_baseline, grocery_and_pharmacy_percent_change_from_baseline)

```

## Retail Prediction BA
```{r BA1 pred, out.width='100%', include=FALSE, echo=FALSE, message=FALSE}
### Retail
b1_pred<-data.frame(BA_DF$date,BA_DF$retail_and_recreation_percent_change_from_baseline)
colnames(b1_pred)<-c('ds','y')
model1 <- prophet(b1_pred, daily.seasonality= TRUE, weekly.seasonality=TRUE) # Fit Model
### Make Future DF
future1 <- make_future_dataframe(model1, periods = L, freq = "days", include_history = FALSE) 
forecast1 <- predict(model1, future1)  #Forecast

```

```{r 21, out.width='100%', echo=FALSE}
plot(model1, forecast1)
```

## Grocery and Pharmacy Prediction BA
```{r BA2 pred, out.width='100%', include=FALSE, echo=FALSE, message=FALSE}
### Retail
b1_pred<-data.frame(BA_DF$date,BA_DF$grocery_and_pharmacy_percent_change_from_baseline)
colnames(b1_pred)<-c('ds','y')
model1 <- prophet(b1_pred, daily.seasonality= TRUE, weekly.seasonality=TRUE) # Fit Model
### Make Future DF
future1 <- make_future_dataframe(model1, periods = L, freq = "days", include_history = FALSE) 
forecast1 <- predict(model1, future1)  #Forecast
```

```{r 21B, out.width='100%', echo=FALSE}
plot(model1, forecast1)
```


## Parks Prediction BA
```{r BA3 pred, out.width='100%', include=FALSE, echo=FALSE, message=FALSE}
b1_pred<-data.frame(BA_DF$date,BA_DF$parks_percent_change_from_baseline)
colnames(b1_pred)<-c('ds','y')
model1 <- prophet(b1_pred, daily.seasonality= TRUE, weekly.seasonality=TRUE) # Fit Model
### Make Future DF
future1 <- make_future_dataframe(model1, periods = L, freq = "days", include_history = FALSE) 
forecast1 <- predict(model1, future1)  #Forecast
```

```{r 22, out.width='100%', echo=FALSE}
plot(model1, forecast1)
```


## Transit Prediction BA
```{r BA4 pred, out.width='100%', include=FALSE, echo=FALSE, message=FALSE}
### Retail
b1_pred<-data.frame(BA_DF$date,BA_DF$transit_stations_percent_change_from_baseline)
colnames(b1_pred)<-c('ds','y')
model1 <- prophet(b1_pred, daily.seasonality= TRUE, weekly.seasonality=TRUE) # Fit Model
### Make Future DF
future1 <- make_future_dataframe(model1, periods = L, freq = "days", include_history = FALSE) 
forecast1 <- predict(model1, future1)  #Forecast
```

```{r 23, out.width='100%', echo=FALSE}
plot(model1, forecast1)
```

## Workplace Prediction BA
```{r BA5 pred, out.width='100%', include=FALSE, echo=FALSE, message=FALSE}
### Retail
b1_pred<-data.frame(BA_DF$date,BA_DF$workplaces_percent_change_from_baseline)
colnames(b1_pred)<-c('ds','y')
model1 <- prophet(b1_pred, daily.seasonality= TRUE, weekly.seasonality=TRUE) # Fit Model
### Make Future DF
future1 <- make_future_dataframe(model1, periods = L, freq = "days", include_history = FALSE) 
forecast1 <- predict(model1, future1)  #Forecast
```

```{r 24, out.width='100%', echo=FALSE}
plot(model1, forecast1)
```

## Residential Prediction BA
```{r BA6 pred, out.width='100%', include=FALSE, echo=FALSE, message=FALSE}
### Retail
b1_pred<-data.frame(BA_DF$date,BA_DF$residential_percent_change_from_baseline)
colnames(b1_pred)<-c('ds','y')
model1 <- prophet(b1_pred, daily.seasonality= TRUE, weekly.seasonality=TRUE) # Fit Model
### Make Future DF
future1 <- make_future_dataframe(model1, periods = L, freq = "days", include_history = FALSE) 
forecast1 <- predict(model1, future1)  #Forecast
```

```{r 25, out.width='100%', echo=FALSE}
plot(model1, forecast1)
```